
load('data/data09032017.mat')

graspTypes={'Pr','Tri','T2','T4','La'};

SR=250;

delay_TW=0.05*SR;

l_TW=0.15*SR;

velThreshold=0.1;

figure(3)
hold on


for i=3:length(sess)

    for j=1:length(sess{i}.trials)
        
        
        
        [motionOnset,motionEnd]=findMotionLimits(angVelocity,SR,lengthTW,overlap,forgetTime,velThreshold)
        
        
        TWvelocity=[];
            
        tTW=[];
        
        
        for kk=1:delay_TW:length(angVel)
            
            if kk+l_TW<length(angVel)
                TWvelocity=[TWvelocity;mean(angVel(kk:kk+l_TW))];
                tTW=[tTW;j+l_TW];
            end

        end
        
        
        
        activeWindows=find(abs(TWvelocity)>velThreshold);

        [~,idx]=max(abs(TWvelocity(activeWindows)));

        while length(activeWindows)~=length(activeWindows(1):activeWindows(end))

            if length(activeWindows(idx:end))~=length(activeWindows(idx):activeWindows(end))
                activeWindows=activeWindows(1:end-1);
            else
                activeWindows=activeWindows(2:end);
            end
                
            [~,idx]=max(abs(TWvelocity(activeWindows)));

        end

        motionOnset=tTW(activeWindows(1))-l_TW;

        motionEnd=tTW(activeWindows(end))+l_TW;
    
        subplot(5,1,1)
        plot(sess{i}.trials{j}.Aperture)
        grid on
        ylabel('Ap')
        title(['session ' num2str(i) ' trial ' num2str(j) ' grasptype ' graspTypes{sess{i}.trials{j}.grasp}])
        
        
        subplot(5,1,2)
        plot(sess{i}.trials{j}.velocity_Aperture)
        grid on
        ylabel('Ap vel')
        
        subplot(5,1,3)
        plot(sess{i}.trials{j}.elbow_angle)
        grid on
        ylabel('elbow angle')
        
        subplot(5,1,4)
        plot(sess{i}.trials{j}.elbow_angular_velocity)
        grid on
        ylabel('elbow ang vel')
        
        subplot(5,1,5)
        plot(sess{i}.trials{j}.emg)
        grid on
        ylabel('emg')
        
        pause;
    
    end


end